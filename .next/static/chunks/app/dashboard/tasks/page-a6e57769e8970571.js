(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[276],{8847:function(e,r,t){Promise.resolve().then(t.bind(t,5771))},5771:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return u}});var a=t(7437),i=t(2265),d=t(2108),s=t(9376),n=t(9520);t(1005);var l=t(925),o=t(4362),c=t(5978);function u(){(0,s.useRouter)();let{user:e}=(0,o.a)(),[r,t]=(0,i.useState)([]),[u,m]=(0,i.useState)(!0),[x,g]=(0,i.useState)(!1),[h,y]=(0,i.useState)(!1),[b,p]=(0,i.useState)({title:"",description:"",dueDate:null,completed:!1,priority:"medium",userId:(null==e?void 0:e.id)||""}),[f,k]=(0,i.useState)({title:"",description:"",dueDate:null,completed:!1,priority:"medium",userId:(null==e?void 0:e.id)||""});(0,i.useEffect)(()=>{!async function(){if(null==e?void 0:e.id)try{let r=(await (0,l.qi)(l.Ul.TASKS)).filter(r=>r.userId===e.id).map(e=>({...e,priority:e.priority||"medium"}));t(r)}catch(e){console.error("Error fetching tasks:",e)}finally{m(!1)}}()},[null==e?void 0:e.id]);let v=async e=>{try{let a=r.find(r=>r.id===e);if(!a)return;await (0,l.gU)(l.Ul.TASKS,e,{completed:!a.completed}),t(r.map(r=>r.id===e?{...r,completed:!r.completed}:r))}catch(e){console.error("Error updating task completion:",e)}},w=async e=>{try{await (0,l.iH)(l.Ul.TASKS,e),t(r.filter(r=>r.id!==e))}catch(e){console.error("Error deleting task:",e)}},j=async()=>{if(""!==b.title.trim()&&(null==e?void 0:e.id))try{let a={title:b.title,description:b.description,completed:!1,userId:e.id,priority:b.priority,...b.dueDate&&{dueDate:c.EK.fromDate(b.dueDate)},...b.customerId&&{customerId:b.customerId},...b.dealId&&{dealId:b.dealId}},i=await (0,l.OE)(l.Ul.TASKS,a);t([...r,i]),p({title:"",description:"",dueDate:null,completed:!1,priority:"medium",userId:e.id}),g(!1)}catch(e){console.error("Error adding task:",e)}},N=async()=>{if(""!==f.title.trim()&&(null==e?void 0:e.id)&&f.id)try{let e={title:f.title,description:f.description,completed:f.completed,priority:f.priority,...f.dueDate&&{dueDate:c.EK.fromDate(f.dueDate)},...f.customerId&&{customerId:f.customerId},...f.dealId&&{dealId:f.dealId}};await (0,l.gU)(l.Ul.TASKS,f.id,e),t(r.map(r=>r.id===f.id?{...r,...e}:r)),y(!1)}catch(e){console.error("Error updating task:",e)}},I=e=>{k({id:e.id,title:e.title,description:e.description||"",dueDate:e.dueDate?e.dueDate instanceof c.EK?e.dueDate.toDate():e.dueDate:null,completed:e.completed,priority:e.priority||"medium",userId:e.userId,customerId:e.customerId,dealId:e.dealId}),y(!0)},E=e=>{if(!e)return"No date";let r=e instanceof c.EK?e.toDate():e instanceof Date?e:null;return r?(0,d.WU)(r,"MMM d, yyyy"):"Invalid date"},S=e=>{switch(e){case"high":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"low":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}};return u?(0,a.jsx)("div",{className:"text-center p-8 dark:text-white",children:"Загрузка задач..."}):(0,a.jsxs)("div",{className:"container mx-auto p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold dark:text-white",children:"Задачи"}),(0,a.jsx)("button",{onClick:()=>g(!0),className:"bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md",children:"Добавить задачу"})]}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden p-2",children:(0,a.jsx)("div",{className:"divide-y divide-gray-200 dark:divide-gray-700 space-y-2",children:0===r.length?(0,a.jsx)("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 rounded-md",children:"Задач нет. Создайте свою первую задачу!"}):r.map(e=>(0,a.jsx)("div",{className:"p-4 rounded-md shadow-sm border border-gray-200 dark:border-gray-600 ".concat(e.completed?"bg-gray-100 dark:bg-gray-700":"bg-gray-50 dark:bg-gray-800"),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("input",{type:"checkbox",checked:e.completed,onChange:()=>v(e.id),className:"mt-1 h-4 w-4 text-primary-600 rounded"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium ".concat(e.completed?"line-through text-gray-500 dark:text-gray-400":"dark:text-white"),children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description}),(0,a.jsxs)("div",{className:"flex space-x-2 mt-2",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:E(e.dueDate)}),e.priority&&(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full ".concat(S(e.priority)),children:e.priority})]})]})]}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("button",{onClick:()=>I(e),className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 mr-2",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,a.jsx)("button",{onClick:()=>w(e.id),className:"text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},e.id))})}),x&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 dark:text-white",children:"Добавить задачу"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Название"}),(0,a.jsx)("input",{type:"text",value:b.title,onChange:e=>p({...b,title:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Название задачи"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Описание"}),(0,a.jsx)("textarea",{value:b.description,onChange:e=>p({...b,description:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Описание задачи",rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Дата завершения"}),(0,a.jsx)(n.ZP,{selected:b.dueDate,onChange:e=>p({...b,dueDate:e}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholderText:"Выберите дату завершения"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Приоритет"}),(0,a.jsxs)("select",{value:b.priority,onChange:e=>p({...b,priority:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,a.jsx)("option",{value:"high",children:"Высокий"}),(0,a.jsx)("option",{value:"medium",children:"Средний"}),(0,a.jsx)("option",{value:"low",children:"Низкий"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-6",children:[(0,a.jsx)("button",{onClick:()=>g(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Отменить"}),(0,a.jsx)("button",{onClick:j,className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:"Добавить задачу"})]})]})}),h&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 dark:text-white",children:"Редактировать задачу"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Название"}),(0,a.jsx)("input",{type:"text",value:f.title,onChange:e=>k({...f,title:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Название задачи"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Описание"}),(0,a.jsx)("textarea",{value:f.description,onChange:e=>k({...f,description:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Описание задачи",rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Дата завершения"}),(0,a.jsx)(n.ZP,{selected:f.dueDate,onChange:e=>k({...f,dueDate:e}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholderText:"Выберите дату завершения"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Приоритет"}),(0,a.jsxs)("select",{value:f.priority,onChange:e=>k({...f,priority:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,a.jsx)("option",{value:"high",children:"Высокий"}),(0,a.jsx)("option",{value:"medium",children:"Средний"}),(0,a.jsx)("option",{value:"low",children:"Низкий"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Статус"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:f.completed,onChange:e=>k({...f,completed:e.target.checked}),className:"h-4 w-4 text-primary-600 rounded"}),(0,a.jsx)("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"Выполнено"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-6",children:[(0,a.jsx)("button",{onClick:()=>y(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Отменить"}),(0,a.jsx)("button",{onClick:N,className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:"Save Changes"})]})]})})]})}},4362:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return l},a:function(){return o}});var a=t(7437),i=t(2265),d=t(8123),s=t(6410);let n=(0,i.createContext)({firebaseUser:null,user:null,loading:!0,error:null});function l(e){let{children:r}=e,[t,l]=(0,i.useState)(null),[o,c]=(0,i.useState)(null),[u,m]=(0,i.useState)(!0),[x,g]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if(!s.l2)return m(!1),g("Firebase is not properly configured. Please check your environment variables."),()=>{};try{let e=(0,d.yv)(async e=>{if(l(e),e)try{let e=await (0,d.ts)();c(e)}catch(e){console.error("Error getting user data:",e),g("Error loading user data")}else c(null);m(!1)});return()=>e()}catch(e){return console.error("Error setting up auth listener:",e),m(!1),g("Error initializing authentication"),()=>{}}},[]),(0,a.jsx)(n.Provider,{value:{firebaseUser:t,user:o,loading:u,error:x},children:r})}function o(){return(0,i.useContext)(n)}},8123:function(e,r,t){"use strict";t.d(r,{a$:function(){return n},ts:function(){return c},w7:function(){return o},yv:function(){return u},zB:function(){return l}});var a=t(3301),i=t(5978),d=t(6410),s=t(925);async function n(e,r,t){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"USER";if(!d.I8||!d.db)throw Error("Firebase is not initialized");let l=(await (0,a.Xb)(d.I8,e,r)).user,o={name:t,email:e,role:n};return await (0,i.pl)((0,i.JU)(d.db,s.Ul.USERS,l.uid),o),{...o,id:l.uid}}async function l(e,r){if(!d.I8)throw Error("Firebase is not initialized");return(0,a.e5)(d.I8,e,r)}async function o(){if(!d.I8)throw Error("Firebase is not initialized");return(0,a.w7)(d.I8)}async function c(){if(!d.I8||!d.db)throw Error("Firebase is not initialized");let e=d.I8.currentUser;if(!e)return null;let r=await (0,i.QT)((0,i.JU)(d.db,s.Ul.USERS,e.uid));return r.exists()?{id:e.uid,...r.data()}:null}function u(e){if(!d.I8)throw Error("Firebase is not initialized");return(0,a.Aj)(d.I8,e)}},6410:function(e,r,t){"use strict";t.d(r,{I8:function(){return c},db:function(){return o},l2:function(){return l}});var a=t(738),i=t(5978),d=t(3301),s=t(257);let n={apiKey:"AIzaSyDpUQ4adXyWWieDcE63OnU2uLzX9C8WVyI",authDomain:"crm-system2014812.firebaseapp.com",projectId:"crm-system2014812",storageBucket:"crm-system2014812.firebasestorage.app",messagingSenderId:"281061278803",appId:"1:281061278803:web:7b2d18b0b67fcbeb1832a6",...s.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID?{measurementId:s.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID}:{}};console.log("Firebase config check:"),console.log("API Key exists:",!0),console.log("Auth Domain exists:",!0),console.log("Project ID exists:",!0),console.log("Storage Bucket exists:",!0),console.log("Messaging Sender ID exists:",!0),console.log("App ID exists:",!0);let l=null,o=null,c=null;if(n.apiKey&&n.authDomain&&n.projectId)try{l=(0,a.ZF)(n),o=(0,i.ad)(l),c=(0,d.v0)(l),console.log("Firebase initialized successfully!")}catch(e){console.error("Firebase initialization error:",e),l=null,o=null,c=null}else console.warn("Firebase configuration is missing. Please set environment variables."),n.apiKey||console.warn("Missing: NEXT_PUBLIC_FIREBASE_API_KEY"),n.authDomain||console.warn("Missing: NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN"),n.projectId||console.warn("Missing: NEXT_PUBLIC_FIREBASE_PROJECT_ID"),n.storageBucket||console.warn("Missing: NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET"),n.messagingSenderId||console.warn("Missing: NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID"),n.appId||console.warn("Missing: NEXT_PUBLIC_FIREBASE_APP_ID")},925:function(e,r,t){"use strict";t.d(r,{OE:function(){return s},Ul:function(){return d},gU:function(){return l},iH:function(){return o},qi:function(){return n}});var a=t(5978),i=t(6410);let d={USERS:"users",CUSTOMERS:"customers",DEALS:"deals",TASKS:"tasks",NOTES:"notes",CONTACTS:"contacts"};async function s(e,r){let t=(0,a.hJ)(i.db,e);return{id:(await (0,a.ET)(t,{...r,createdAt:(0,a.Bt)(),updatedAt:(0,a.Bt)()})).id,...r}}async function n(e){let r=(0,a.hJ)(i.db,e);return(await (0,a.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}async function l(e,r,t){let d=(0,a.JU)(i.db,e,r);return await (0,a.r7)(d,{...t,updatedAt:(0,a.Bt)()}),{id:r,...t}}async function o(e,r){let t=(0,a.JU)(i.db,e,r);return await (0,a.oe)(t),{id:r}}}},function(e){e.O(0,[360,358,717,333,282,840,372,86,971,117,744],function(){return e(e.s=8847)}),_N_E=e.O()}]);