(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[923],{5068:function(e,r,t){Promise.resolve().then(t.bind(t,9311))},9311:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return i}});var a=t(7437),s=t(2265),n=t(925),l=t(4362);function i(){let{user:e}=(0,l.a)(),[r,t]=(0,s.useState)([]),[i,d]=(0,s.useState)(!0),[o,c]=(0,s.useState)(!1),[u,x]=(0,s.useState)(!1),[g,m]=(0,s.useState)(""),[h,p]=(0,s.useState)("ALL"),[y,b]=(0,s.useState)({name:"",email:"",phone:"",company:"",status:"LEAD",userId:(null==e?void 0:e.id)||""}),[f,v]=(0,s.useState)(null);(0,s.useEffect)(()=>{!async function(){if(null==e?void 0:e.id)try{let r=(await (0,n.qi)(n.Ul.CUSTOMERS)).filter(r=>r.userId===e.id);t(r)}catch(e){console.error("Error fetching customers:",e)}finally{d(!1)}}()},[null==e?void 0:e.id]);let k=r.filter(e=>{let r=e.name.toLowerCase().includes(g.toLowerCase())||e.email&&e.email.toLowerCase().includes(g.toLowerCase())||e.company&&e.company.toLowerCase().includes(g.toLowerCase()),t="ALL"===h||e.status===h;return r&&t}),j=async()=>{if(""!==y.name.trim()&&e)try{let a={...y,userId:e.id},s=await (0,n.OE)(n.Ul.CUSTOMERS,a);t([...r,s]),b({name:"",email:"",phone:"",company:"",status:"LEAD",userId:e.id}),c(!1)}catch(e){console.error("Error adding customer:",e)}},w=e=>{e.id&&(v(e),x(!0))},N=async()=>{if(f&&e&&f.id)try{let{id:e,...a}=f;await (0,n.gU)(n.Ul.CUSTOMERS,e,a),t(r.map(r=>r.id===e?f:r)),x(!1),v(null)}catch(e){console.error("Error updating customer:",e)}},E=async e=>{try{await (0,n.iH)(n.Ul.CUSTOMERS,e),t(r.filter(r=>r.id!==e))}catch(e){console.error("Error deleting customer:",e)}},I=e=>{switch(e){case"LEAD":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"PROSPECT":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";case"ACTIVE":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}};return(0,a.jsxs)("div",{className:"container mx-auto p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold dark:text-white",children:"Клиенты"}),(0,a.jsx)("button",{onClick:()=>c(!0),className:"bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md",children:"Добавить клиента"})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden mb-6",children:[(0,a.jsxs)("div",{className:"p-4 flex flex-col md:flex-row justify-between gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-grow",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})}),(0,a.jsx)("input",{type:"text",value:g,onChange:e=>m(e.target.value),placeholder:"Поиск клиентов...",className:"pl-10 p-2 border border-gray-300 dark:border-gray-600 rounded-md w-full dark:bg-gray-700 dark:text-white dark:placeholder-gray-400"})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("select",{value:h,onChange:e=>p(e.target.value),className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,a.jsx)("option",{value:"ALL",children:"Все статусы"}),(0,a.jsx)("option",{value:"LEAD",children:"Lead"}),(0,a.jsx)("option",{value:"PROSPECT",children:"Prospect"}),(0,a.jsx)("option",{value:"ACTIVE",children:"Active"}),(0,a.jsx)("option",{value:"INACTIVE",children:"Inactive"})]})})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Имя"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Эл. почта"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Телефон"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Компания"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Статус"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Действия"})]})}),(0,a.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===k.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"Не найдено клиентов"})}):k.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.phone})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.company})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(I(e.status)),children:e.status})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[(0,a.jsx)("button",{onClick:()=>w(e),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-4",children:"Редактировать"}),(0,a.jsx)("button",{onClick:()=>E(e.id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:"Удалить"})]})]},e.id))})]})})]}),o&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 dark:text-white",children:"Добавить клиента"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Имя"}),(0,a.jsx)("input",{type:"text",value:y.name,onChange:e=>b({...y,name:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Имя клиента"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Эл. почта"}),(0,a.jsx)("input",{type:"email",value:y.email,onChange:e=>b({...y,email:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Эл. почта"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Телефон"}),(0,a.jsx)("input",{type:"text",value:y.phone,onChange:e=>b({...y,phone:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Телефон"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Компания"}),(0,a.jsx)("input",{type:"text",value:y.company,onChange:e=>b({...y,company:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Название компании"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Статус"}),(0,a.jsxs)("select",{value:y.status,onChange:e=>b({...y,status:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,a.jsx)("option",{value:"LEAD",children:"Lead"}),(0,a.jsx)("option",{value:"PROSPECT",children:"Prospect"}),(0,a.jsx)("option",{value:"ACTIVE",children:"Active"}),(0,a.jsx)("option",{value:"INACTIVE",children:"Inactive"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-6",children:[(0,a.jsx)("button",{onClick:()=>c(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Отменить"}),(0,a.jsx)("button",{onClick:j,className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:"Добавить клиента"})]})]})}),u&&f&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 dark:text-white",children:"Edit Customer"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Имя"}),(0,a.jsx)("input",{type:"text",value:f.name,onChange:e=>v({...f,name:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Имя клиента"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Эл. почта"}),(0,a.jsx)("input",{type:"email",value:f.email||"",onChange:e=>v({...f,email:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Эл. почта"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Телефон"}),(0,a.jsx)("input",{type:"text",value:f.phone||"",onChange:e=>v({...f,phone:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Телефон"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Компания"}),(0,a.jsx)("input",{type:"text",value:f.company||"",onChange:e=>v({...f,company:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",placeholder:"Название компании"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Статус"}),(0,a.jsxs)("select",{value:f.status,onChange:e=>v({...f,status:e.target.value}),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white",children:[(0,a.jsx)("option",{value:"LEAD",children:"Lead"}),(0,a.jsx)("option",{value:"PROSPECT",children:"Prospect"}),(0,a.jsx)("option",{value:"ACTIVE",children:"Active"}),(0,a.jsx)("option",{value:"INACTIVE",children:"Inactive"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-6",children:[(0,a.jsx)("button",{onClick:()=>{x(!1),v(null)},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Отменить"}),(0,a.jsx)("button",{onClick:N,className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:"Обновить клиента"})]})]})})]})}},4362:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return d},a:function(){return o}});var a=t(7437),s=t(2265),n=t(8123),l=t(6410);let i=(0,s.createContext)({firebaseUser:null,user:null,loading:!0,error:null});function d(e){let{children:r}=e,[t,d]=(0,s.useState)(null),[o,c]=(0,s.useState)(null),[u,x]=(0,s.useState)(!0),[g,m]=(0,s.useState)(null);return(0,s.useEffect)(()=>{if(!l.l2)return x(!1),m("Firebase is not properly configured. Please check your environment variables."),()=>{};try{let e=(0,n.yv)(async e=>{if(d(e),e)try{let e=await (0,n.ts)();c(e)}catch(e){console.error("Error getting user data:",e),m("Error loading user data")}else c(null);x(!1)});return()=>e()}catch(e){return console.error("Error setting up auth listener:",e),x(!1),m("Error initializing authentication"),()=>{}}},[]),(0,a.jsx)(i.Provider,{value:{firebaseUser:t,user:o,loading:u,error:g},children:r})}function o(){return(0,s.useContext)(i)}},8123:function(e,r,t){"use strict";t.d(r,{a$:function(){return i},ts:function(){return c},w7:function(){return o},yv:function(){return u},zB:function(){return d}});var a=t(3301),s=t(5978),n=t(6410),l=t(925);async function i(e,r,t){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"USER";if(!n.I8||!n.db)throw Error("Firebase is not initialized");let d=(await (0,a.Xb)(n.I8,e,r)).user,o={name:t,email:e,role:i};return await (0,s.pl)((0,s.JU)(n.db,l.Ul.USERS,d.uid),o),{...o,id:d.uid}}async function d(e,r){if(!n.I8)throw Error("Firebase is not initialized");return(0,a.e5)(n.I8,e,r)}async function o(){if(!n.I8)throw Error("Firebase is not initialized");return(0,a.w7)(n.I8)}async function c(){if(!n.I8||!n.db)throw Error("Firebase is not initialized");let e=n.I8.currentUser;if(!e)return null;let r=await (0,s.QT)((0,s.JU)(n.db,l.Ul.USERS,e.uid));return r.exists()?{id:e.uid,...r.data()}:null}function u(e){if(!n.I8)throw Error("Firebase is not initialized");return(0,a.Aj)(n.I8,e)}},6410:function(e,r,t){"use strict";t.d(r,{I8:function(){return c},db:function(){return o},l2:function(){return d}});var a=t(738),s=t(5978),n=t(3301),l=t(257);let i={apiKey:"AIzaSyDpUQ4adXyWWieDcE63OnU2uLzX9C8WVyI",authDomain:"crm-system2014812.firebaseapp.com",projectId:"crm-system2014812",storageBucket:"crm-system2014812.firebasestorage.app",messagingSenderId:"281061278803",appId:"1:281061278803:web:7b2d18b0b67fcbeb1832a6",...l.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID?{measurementId:l.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID}:{}};console.log("Firebase config check:"),console.log("API Key exists:",!0),console.log("Auth Domain exists:",!0),console.log("Project ID exists:",!0),console.log("Storage Bucket exists:",!0),console.log("Messaging Sender ID exists:",!0),console.log("App ID exists:",!0);let d=null,o=null,c=null;if(i.apiKey&&i.authDomain&&i.projectId)try{d=(0,a.ZF)(i),o=(0,s.ad)(d),c=(0,n.v0)(d),console.log("Firebase initialized successfully!")}catch(e){console.error("Firebase initialization error:",e),d=null,o=null,c=null}else console.warn("Firebase configuration is missing. Please set environment variables."),i.apiKey||console.warn("Missing: NEXT_PUBLIC_FIREBASE_API_KEY"),i.authDomain||console.warn("Missing: NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN"),i.projectId||console.warn("Missing: NEXT_PUBLIC_FIREBASE_PROJECT_ID"),i.storageBucket||console.warn("Missing: NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET"),i.messagingSenderId||console.warn("Missing: NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID"),i.appId||console.warn("Missing: NEXT_PUBLIC_FIREBASE_APP_ID")},925:function(e,r,t){"use strict";t.d(r,{OE:function(){return l},Ul:function(){return n},gU:function(){return d},iH:function(){return o},qi:function(){return i}});var a=t(5978),s=t(6410);let n={USERS:"users",CUSTOMERS:"customers",DEALS:"deals",TASKS:"tasks",NOTES:"notes",CONTACTS:"contacts"};async function l(e,r){let t=(0,a.hJ)(s.db,e);return{id:(await (0,a.ET)(t,{...r,createdAt:(0,a.Bt)(),updatedAt:(0,a.Bt)()})).id,...r}}async function i(e){let r=(0,a.hJ)(s.db,e);return(await (0,a.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}async function d(e,r,t){let n=(0,a.JU)(s.db,e,r);return await (0,a.r7)(n,{...t,updatedAt:(0,a.Bt)()}),{id:r,...t}}async function o(e,r){let t=(0,a.JU)(s.db,e,r);return await (0,a.oe)(t),{id:r}}}},function(e){e.O(0,[358,717,840,971,117,744],function(){return e(e.s=5068)}),_N_E=e.O()}]);